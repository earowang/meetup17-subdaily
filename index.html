<!DOCTYPE html>
<html>
  <head>
    <title>Analysing sub-daily time series data</title>
    <meta charset="utf-8">
    <meta name="author" content="Earo Wang" />
    <link href="index_files/remark-css/example.css" rel="stylesheet" />
    <link rel="stylesheet" href="myremark.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Analysing sub-daily time series data
### Earo Wang
### Oct 12, 2017 <br> <br> Slides on <a href="http://bit.ly/subdaily" class="uri">http://bit.ly/subdaily</a>

---




.left-column[
## Pedestrian counts üö∂‚Äç‚ôÄÔ∏è
### - sensors
]
.right-column[

```r
library(sugrrants)
library(tidyverse)
library(ggmap)

sensor_loc &lt;- rwalkr::pull_sensor()
qmplot(x = Longitude, y = Latitude, data = sensor_loc,
  colour = I("#d95f02"), size = I(4))
```

&lt;img src="figure/sensor-map-1.svg" style="display: block; margin: auto;" /&gt;
]



---

.left-column[
## Pedestrian counts üö∂‚Äç‚ôÄÔ∏è
### - sensors
]
.right-column[

```r
sensors &lt;- c("State Library", "Flagstaff Station",
  "Flinders Street Station Underpass")

sensor_loc %&gt;% 
  mutate(Selected = ifelse(Sensor %in% sensors, TRUE, FALSE)) %&gt;% 
  qmplot(
    x = Longitude, y = Latitude, data = .,
    colour = Selected, shape = Selected, size = I(4)
  ) +
  scale_colour_brewer(palette = "Dark2")
```

&lt;img src="figure/selected-sensor-1.svg" style="display: block; margin: auto;" /&gt;
]

---

.left-column[
## Pedestrian counts üö∂‚Äç‚ôÄÔ∏è
### - sensors
### - the data
]
.right-column[

```r
pedestrian &lt;- as_tibble(rwalkr::run_melb(year = 2016))
subdat &lt;- pedestrian %&gt;% 
  filter(Sensor %in% sensors) %&gt;% 
  mutate(Day = wday2(Date, label = TRUE))
subdat
```

```
#&gt; # A tibble: 26,352 x 6
#&gt;                               Sensor           Date_Time
#&gt;                                &lt;chr&gt;              &lt;dttm&gt;
#&gt;  1 Flinders Street Station Underpass 2016-01-01 00:00:00
#&gt;  2                     State Library 2016-01-01 00:00:00
#&gt;  3                 Flagstaff Station 2016-01-01 00:00:00
#&gt;  4 Flinders Street Station Underpass 2016-01-01 01:00:00
#&gt;  5                     State Library 2016-01-01 01:00:00
#&gt;  6                 Flagstaff Station 2016-01-01 01:00:00
#&gt;  7 Flinders Street Station Underpass 2016-01-01 02:00:00
#&gt;  8                     State Library 2016-01-01 02:00:00
#&gt;  9                 Flagstaff Station 2016-01-01 02:00:00
#&gt; 10 Flinders Street Station Underpass 2016-01-01 03:00:00
#&gt; # ... with 26,342 more rows, and 4 more variables:
#&gt; #   Date &lt;date&gt;, Time &lt;int&gt;, Count &lt;int&gt;, Day &lt;ord&gt;
```
]

---

.left-column[
## Conventional displays
### - time series plot
]
.right-column[
&lt;img src="figure/ts-plot-1.svg" style="display: block; margin: auto;" /&gt;
]

---

.left-column[
## Conventional displays
### - time series plot
]
.right-column[

```r
# conventional time series plot
subdat %&gt;% 
  ggplot(aes(x = Date_Time, y = Count, colour = Sensor)) +
  geom_line(size = 0.5) +
  facet_grid(
    Sensor ~ ., 
    labeller = labeller(Sensor = label_wrap_gen(20))
  ) +
  scale_colour_brewer(
    palette = "Dark2", 
    guide = guide_legend(title = "Sensor")
  ) +
  theme(legend.position = "bottom") +
  xlab("Date Time") +
  ylab("Hourly Counts")
```
]

---

.left-column[
## Conventional displays
### - time series plot
### - faceted display
]
.right-column[
&lt;img src="figure/facet-time-1.svg" style="display: block; margin: auto;" /&gt;
]

---

.left-column[
## Conventional displays
### - time series plot
### - faceted display
]
.right-column[

```r
# time series plot faceted by sensors and day of week
subdat %&gt;% 
  ggplot(aes(x = Time, y = Count, group = Date, 
    colour = Sensor)) +
  geom_line(size = 0.5) +
  facet_grid(
    Sensor ~ Day, 
    labeller = labeller(Sensor = label_wrap_gen(20))
  ) +
  scale_x_continuous(breaks = seq(6, 23, by = 6)) +
  scale_colour_brewer(
    palette = "Dark2", 
    guide = guide_legend(title = "Sensor")
  ) +
  theme(legend.position = "bottom") +
  xlab("Time") +
  ylab("Hourly Counts")
```
]

---

class: inverse middle center

# Calendar-based visualisation

---

background-image: url(img/calendar.png)
background-size: cover

---



&lt;img src="figure/flinders-2016-plot-1.svg" style="display: block; margin: auto;" /&gt;

---

.left-column[
## Calendar-based vis
### - rearrange
]
.right-column[
### The `frame_calendar()` function

```r
# calendar plot for flinders street station
flinders &lt;- subdat %&gt;% 
  filter(Sensor == "Flinders Street Station Underpass")

flinders_cal &lt;- flinders %&gt;%
  frame_calendar(x = Time, y = Count, date = Date)
flinders_cal
```

```
#&gt; # A tibble: 8,784 x 8
#&gt;                               Sensor           Date_Time
#&gt;  *                             &lt;chr&gt;              &lt;dttm&gt;
#&gt;  1 Flinders Street Station Underpass 2016-01-01 00:00:00
#&gt;  2 Flinders Street Station Underpass 2016-01-01 01:00:00
#&gt;  3 Flinders Street Station Underpass 2016-01-01 02:00:00
#&gt;  4 Flinders Street Station Underpass 2016-01-01 03:00:00
#&gt;  5 Flinders Street Station Underpass 2016-01-01 04:00:00
#&gt;  6 Flinders Street Station Underpass 2016-01-01 05:00:00
#&gt;  7 Flinders Street Station Underpass 2016-01-01 06:00:00
#&gt;  8 Flinders Street Station Underpass 2016-01-01 07:00:00
#&gt;  9 Flinders Street Station Underpass 2016-01-01 08:00:00
#&gt; 10 Flinders Street Station Underpass 2016-01-01 09:00:00
#&gt; # ... with 8,774 more rows, and 6 more variables:
#&gt; #   Time &lt;int&gt;, Count &lt;int&gt;, Day &lt;ord&gt;, Date &lt;date&gt;,
#&gt; #   .Time &lt;dbl&gt;, .Count &lt;dbl&gt;
```
]

---

.left-column[
## Calendar-based vis
### - rearrange
]
.right-column[
### The args of `frame_calendar()`
```
frame_calendar(
  data, x, y, date, calendar = "monthly", dir = "h",
  sunday = FALSE, nrow = NULL, ncol = NULL, polar = FALSE,
  scale = "fixed", width = 0.95, height = 0.95
)
```
]


---

.left-column[
## Calendar-based vis
### - rearrange
### - ggplot2 vis
]
.right-column[

```r
p_flinders &lt;- flinders_cal %&gt;% 
  ggplot(aes(x = .Time, y = .Count, group = Date)) +
  geom_line()
prettify(p_flinders)
```

&lt;img src="figure/flinders-2016-plot-1.svg" style="display: block; margin: auto;" /&gt;
]

---

.left-column[
## Calendar-based vis
### - rearrange
### - ggplot2 vis
### - variations
]
.right-column[
]


---

class: inverse middle center

## This work is licensed under &lt;br&gt; [&lt;i class="fa fa-creative-commons" aria-hidden="true"&gt;&lt;/i&gt; Creative Commons](https://creativecommons.org/licenses/by-nc-sa/4.0/)
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
